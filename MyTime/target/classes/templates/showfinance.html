<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="container" ></div>
<div id="containers" style="width: 550px; height: 400px; margin: 0 auto"></div>








<!--<script th:src="@{/static/js/jquery-1.8.0.min.js}" type="text/javascript"></script>-->
<script th:src="@{http://cdn.staticfile.org/jquery/2.1.4/jquery.min.js}"></script>
<script th:src="@{http://code.highcharts.com/highcharts.js}"></script>
<!--<script th:src="@{/static/js/highcharts.js}" type="text/javascript" ></script>-->
<script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function () {

        $.ajax({
            type: "POST",
            url: "/time/queryfinance",
            dataType: "json",

            success: function (data) {

                var appTime = new Array();
                var appMoney = new Array();



                if (data.code == 20000) {

                    for (var i = 0; i < data.data.length; i++) {
                        // var money = data.data[i].money;
                        // var time = data.data[i].time;
                        // appMoney += (money + ",");
                        // appTime  += ("'"+time  + "',");
                        appTime.push(data.data[i].time);
                        appMoney.push(data.data[i].money);
                    }

                    // var money = "[" + appMoney.substring(0,appMoney.length-1) + "]";
                    // var time = "[" + appTime.substring(0,appTime.length-1) + "]";
                    // var money = appMoney.substring(0,appMoney.length-1).split(",");
                    // var time = appTime.substring(0,appTime.length-1).split(",");


                    var title = {
                        text: '开销'
                    };
                    var subtitle = {
                        text: 'Source: 鸹貔'
                    };
                    var xAxis = {
                        categories: appTime
                    };
                    var yAxis = {
                        title: {
                            text: 'finance (元)'
                        },
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }]
                    };

                    var tooltip = {
                        valueSuffix: '元'
                    }

                    var legend = {
                        layout: 'vertical',
                        align: 'right',
                        verticalAlign: 'middle',
                        borderWidth: 0
                    };

                    var series =  [
                        {
                            name: '花销',
                            data: appMoney
                        }
                    ];

                    var json = {};

                    json.title = title;
                    json.subtitle = subtitle;
                    json.xAxis = xAxis;
                    json.yAxis = yAxis;
                    json.tooltip = tooltip;
                    json.legend = legend;
                    json.series = series;

                    $('#container').highcharts(json);






                    var sunmoney = 0;
                    var traffic = 0 ;
                    var diet = 0;
                    var other = 0;
                    for (var i = 0; i < data.data.length; i++) {
                        sunmoney = sunmoney + data.data[i].money;
                        if(data.data[i].purpose == "吃饭"){
                            diet = diet + data.data[i].money;
                        }
                        if(data.data[i].purpose == "交通"){
                            traffic = traffic + data.data[i].money;
                        }
                        if(data.data[i].purpose == "其他"){
                            other = other + data.data[i].money;
                        }
                    }
                    alert("总：" + sunmoney + "\n" + "交通：" + traffic+ "\n" + "吃饭：" + diet+ "\n" + "其他：" + other);
                    var list = new Array();
                    var traffics = new Array();
                    traffics.push("交通");
                    traffics.push(traffic/(other + diet + traffic));
                    list.push(traffics);
                    var diets = new Array();
                    diets.push("吃饭");
                    diets.push(diets/(other + diet + traffic));
                    list.push(diets);
                    var others = new Array();
                    others.push("其他");
                    others.push(others/(other + diet + traffic));
                    list.push(others);

                    alert(list);
                    var chart = {
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false
                    };
                    var title = {
                        text: '各项目支出占有比例'
                    };
                    var tooltip = {
                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                    };
                    var plotOptions = {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: true,
                                format: '<b>{point.name}%</b>: {point.percentage:.1f} %',
                                style: {
                                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                                }
                            }
                        }
                    };
                    var series= [{
                        type: 'pie',
                        name: 'Browser share',
                        data: list
                    }];

                    var json = {};
                    json.chart = chart;
                    json.title = title;
                    json.tooltip = tooltip;
                    json.series = series;
                    json.plotOptions = plotOptions;
                    $('#containers').highcharts(json);






                } else if (data.code == 20001) {
                    alert(data.message);
                }

            },
            error: function () {
                alert('哎呀！出错了！');
            }
        });

    });
    /*]]>*/
</script>
</body>
</html>